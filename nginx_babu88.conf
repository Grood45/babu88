server {
    listen 80;
    server_name 11crickex.live www.11crickex.live;

    # Root for Frontend
    root /var/www/babu88/client/dist;
    index index.html;

    # Gzip Compression (Fast Loading)
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # 1. Frontend: Serve React App
    location / {
        try_files $uri $uri/ /index.html;
    }

    # 2. Backend: API Proxy (List of all API routes)
    # We proxy these specific paths to the backend/PM2
    location ~ ^/(users|deposits|withdraws|home-controls|promotions|categories|kyc|pages|paymentnumber|paymentmethod|depositPaymentMethod|depositPromotions|depositTransactions|withdrawPaymentMethod|withdrawTransactions|admin|features-image|theme-color|social-links|opay|games|loader-config|health|upload|delete|uploads) {
        proxy_pass http://localhost:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # 3. Socket.IO (Realtime)
    location /socket.io/ {
        proxy_pass http://localhost:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
    }

    # Error Logs (Optional, helps in debugging)
    error_log /var/log/nginx/babu88_error.log;
    access_log /var/log/nginx/babu88_access.log;
}
